import { Component } from 'react'
import { graphql } from 'react-apollo'
import { get as getLodash } from 'lodash-es'
import { AppShellSide } from '@target-energysolutions/app-shell'
import { cleanUp } from '@target-energysolutions/hoc-oauth'
import { Router, Redirect, navigate } from '@reach/router'
import { AuthCheckContext } from '@target-energysolutions/auth-check'
import { connect } from 'react-redux'
import { Snackbar, SVGIcon } from 'react-md'

// import { format } from 'date-fns'

import Home from 'components/home'
import { IntlContext, ContentContext } from 'components/app/context'

import { useSupportedLangs, withTranslationEx } from 'libs/langs'
import { getAuthToken } from 'libs/utils/oauth-token'
import meQuery from 'libs/queries/me-query.gql'
import { extractUserInfos } from 'utils/extract-user-infos'
import * as act from 'modules/app/actions'
import { validURL } from 'libs/utils/custom-function'

import './styles.scss'

@connect(
  ({ app, shell }) => ({
    organizationID: shell.organizationId,
    toasts: app.toasts,
    visibleLoader: app.visibleLoader,
  }),
  {
    setUserInfos: act.setUserInfos,
    addToast: act.addToast,
    dismissToast: act.dismissToast,
  },
)
@graphql(meQuery, {
  options: (props) => {
    return {
      notifyOnNetworkStatusChange: true,
      context: {
        uri: `${PRODUCT_WORKSPACE_URL}/graphql`,
      },
    }
  },
  props: ({ data, ownProps: { setUserInfos } }) => {
    let userInfos = null
    if (data.mev2 && data.mev2.user && data.mev2.user.profile) {
      userInfos = extractUserInfos({
        id: data.mev2.user.id,
        subject: data.mev2.user.subject,
        profile: data.mev2.user.profile,
        roles: data.mev2.roles,
        isEnterprise: data.mev2.isEnterpriseUser,
      })
      setUserInfos(userInfos) // save userInfos to redux state.app for use elsewhere
    }
    const me = getLodash(data, 'mev2')
    return { userInfos, me }
  },
})
@withTranslationEx
export default class AppShellWrapper extends Component {
  componentDidMount = () => {
    const { lang } = this.props
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr'
  }
  signOut = () => {
    cleanUp()
    window.location.href = '/'
    // this.props.clearMessages()
  }
  static contextType = AuthCheckContext

  state = {
    wsID: null,
    navBarCollapsed: true,
  }

  static getDerivedStateFromProps(props) {
    const [, subModule] = props.location.pathname.split('/')
    return {
      activeNavSubModule: subModule,
    }
  }

  handleNavModChange = ({ subModule }) => {
    this.setState({
      activeNavSubModule: subModule,
    })
    this.handleNavigateJump(subModule)
  }
  handleNavigateJump = (value) => {
    navigate(`/${value}`)
  }
  render() {
    const {
      // organizationID,
      me,
      toasts,
      dismissToast,
      t,
      lang,
      changeLanguage,
      // langs,
    } = this.props
    // const token = getAccessToken()
    // const { activeNavSubModule } = this.state
    const token = getAuthToken()
    // const orgId = organizationID || get('organizationId')
    const actionMenus = [
      {
        primaryText: 'Manage Accounts',
        onClick: () => navigate('/talent/accounts'),
      },
      {
        primaryText: t('signout'),
        primaryTextStyle: { color: '#f44336' },
        onClick: this.signOut,
      },
    ]

    return (
      <IntlContext.Provider value={lang}>
        <ContentContext.Provider
          value={{
            me,
            token,
            locale: lang,
          }}
        >
          <WSAppShell
            disableSidebar={true}
            // refetchWs={refetchWs}
            actionMenus={actionMenus}
            notificationAPI={PRODUCT_APP_URL_API}
            accessToken={token}
            activeModule={'1'}
            onSideCollapsedClick={this.handleSideCollapsedClick}
            onModuleChange={this.handleModuleChange}
            sideContent={<div />}
            // searchText={searchText}
            // searchPlaceholder={search && search.placeholder}
            onSearchChange={() => {}}
            navigateToHome={this.handleNavigateToHome}
            production="talent"
            productConfig={{
              workspace: PRODUCT_WORKSPACE_URL,
              media: MEETING_URL,
              configurator: PRODUCT_APP_URL_CONFIGURATOR,
              // planner: PRODUCT_APP_URL_PLANNER,
              amc: PRODUCT_APP_URL_AMC,
              map: PRODUCT_APP_URL_MAP,
              hcm: PRODUCT_APP_URL_HCM,
              timesheet: PRODUCT_APP_URL_TIMESHEET,
              pulse: PRODUCT_APP_URL_PULSE,
              reach: PRODUCT_APP_URL_REACH,
              organisation: PRODUCT_APP_URL_ORGANIZATION,
              pdo: PRODUCT_APP_URL_PDO,
              csr: PRODUCT_APP_URL_CSR,
              was: PRODUCT_APP_URL_TROVE,
              okr: PRODUCT_APP_URL_OKR,
              profile: PRODUCT_APP_URL_PROFILE,
              meeting: MEETING_URL,
              crm: PRODUCT_APP_URL_CRM,
              sso: OAUTH_HOST,
              bi: PRODUCT_APP_URL_BI,
              psa: PRODUCT_APP_URL_PSA,
              regulation: PRODUCT_APP_URL_REGULATION,
              peopleanalytics: PRODUCT_APP_URL_PEOPLEANALYTICS,
            }}
            onLogOut={this.signOut}
            modules={{
              extraApps: [
                {
                  key: 'prime',
                  name: 'Prime',
                  onClick: () => null,
                  icon: (
                    <SVGIcon viewBox={'0 0 16 19'}>
                      <path
                        d="M8.14614382,2.00769231 C11.1605284,2.00769231 13.7847207,3.67676923 15.1461438,6.14088462 C15.0140284,6.23892308 14.8952592,6.35596154 14.7948746,6.48976923 L14.7948746,6.48976923 L13.4100284,8.33623077 C12.7025669,6.10284615 10.6105284,4.4795 8.14614382,4.4795 C5.10210535,4.4795 2.62564382,6.956 2.62564382,10 C2.62564382,13.044 5.10210535,15.5205 8.14614382,15.5205 C10.6105284,15.5205 12.7025669,13.8971538 13.4100284,11.6637692 L13.4100284,11.6637692 L14.794913,13.5103077 C14.8952592,13.6441154 15.0140284,13.7611154 15.1461438,13.8591538 C13.7847207,16.3232692 11.1605284,17.9923077 8.14614382,17.9923077 C3.73210535,17.9923077 0.153836124,14.4140385 0.153836124,10 C0.153836124,5.58596154 3.73210535,2.00769231 8.14614382,2.00769231 Z M8.14614382,5.63334615 C10.3583746,5.63334615 12.1914515,7.287 12.4746438,9.42307692 L12.4746438,9.42307692 L11.139413,9.42307692 C10.868913,8.01703846 9.62995151,6.95126923 8.14614382,6.95126923 C6.46506689,6.95126923 5.09741305,8.31892308 5.09741305,10 C5.09741305,11.6810769 6.46506689,13.0487308 8.14614382,13.0487308 C9.62995151,13.0487308 10.868913,11.9829615 11.139413,10.5769231 L11.139413,10.5769231 L12.4746438,10.5769231 C12.1914515,12.713 10.3583746,14.3666538 8.14614382,14.3666538 C5.73833612,14.3666538 3.77948997,12.4077692 3.77948997,10 C3.77948997,7.59223077 5.73833612,5.63334615 8.14614382,5.63334615 Z M19.2692207,6.95126923 C19.4877592,6.95126923 19.6875284,7.07473077 19.7852592,7.27019231 C19.88299,7.46565385 19.8618746,7.69953846 19.7307592,7.87434615 L19.7307592,7.87434615 L18.1365284,10 L19.7307592,12.1256538 C19.8618746,12.3004615 19.88299,12.5343462 19.7852592,12.7298077 C19.68749,12.9252692 19.4877592,13.0487308 19.2692207,13.0487308 L19.2692207,13.0487308 L16.17949,13.0487308 C15.997913,13.0487308 15.826913,12.9632308 15.7179515,12.8179615 L15.7179515,12.8179615 L13.8641054,10.3461538 C13.7102592,10.1410385 13.7102592,9.85896154 13.8641054,9.65384615 L13.8641054,9.65384615 L15.7179515,7.18203846 C15.826913,7.03676923 15.997913,6.95126923 16.17949,6.95126923 L16.17949,6.95126923 Z M8.14614382,8.10511538 C8.98983612,8.10511538 9.7062592,8.65953846 9.95091305,9.42307692 L9.95091305,9.42307692 L8.14614382,9.42307692 C7.82752843,9.42307692 7.56922074,9.68138462 7.56922074,10 C7.56922074,10.3186154 7.82752843,10.5769231 8.14614382,10.5769231 L8.14614382,10.5769231 L9.95091305,10.5769231 C9.7062592,11.3404615 8.98987459,11.8948846 8.14614382,11.8948846 C7.10129766,11.8948846 6.2512592,11.0448462 6.2512592,10 C6.2512592,8.95515385 7.10129766,8.10511538 8.14614382,8.10511538 Z"
                        strokeWidth=".5"
                        fillRule="nonzero"
                      />
                    </SVGIcon>
                  ),
                  subModules: [
                    {
                      key: 'vision-and-mission',
                      name: 'Vision & Mission',
                      onClick: () => navigate('/prime/vision'),
                      icon: (
                        <SVGIcon viewBox={'0 0 16 19'}>
                          <path
                            d="M8.5,5.74649157 C8.85686345,5.74649157 9.20488554,5.84756988 9.50651606,6.03873454 L9.72946185,6.1800257 L9.8479498,5.94417631 C10.4407992,4.76438313 11.6232209,3.96934297 12.933757,3.86932289 L13.4491165,3.82999759 L10.7239277,1.07992329 C10.6029478,0.95798755 10.4613153,0.939451406 10.3876486,0.93921245 C10.2596024,0.93921245 10.1403293,0.988642169 10.0505161,1.07831888 L9.50013253,1.62877068 C9.23345783,1.89541124 8.87826707,2.04226667 8.49996586,2.04226667 C8.12166466,2.04226667 7.7664739,1.89544538 7.49986747,1.62877068 L6.94951807,1.07838715 C6.85984137,0.988676305 6.74046586,0.93921245 6.6133755,0.93921245 C6.5390261,0.939280723 6.39722289,0.957646185 6.27610643,1.07982088 L3.5508494,3.82992932 L4.0661747,3.86928876 C5.37674498,3.96934297 6.5592008,4.76438313 7.1520502,5.94417631 L7.27057229,6.1800257 L7.49348394,6.03873454 C7.79514859,5.84756988 8.14317068,5.74649157 8.5,5.74649157 M8.5,6.6857245 C7.97754016,6.6857245 7.55247189,7.11079277 7.55247189,7.63325261 C7.55247189,8.15571245 7.97754016,8.58074659 8.5,8.58074659 C9.02249398,8.58074659 9.44752811,8.15571245 9.44752811,7.63325261 C9.44752811,7.11079277 9.02249398,6.6857245 8.5,6.6857245 M3.77625301,4.79623253 C2.21191165,4.79623253 0.939232932,6.06891124 0.939232932,7.63325261 C0.939232932,9.19759398 2.21191165,10.4702727 3.77625301,10.4702727 C5.34059438,10.4702727 6.61327309,9.19759398 6.61327309,7.63325261 C6.61327309,6.06891124 5.34059438,4.79623253 3.77625301,4.79623253 M13.223747,4.79623253 C11.6594056,4.79623253 10.3867269,6.06891124 10.3867269,7.63325261 C10.3867269,9.19759398 11.6594056,10.4702727 13.223747,10.4702727 C14.7880884,10.4702727 16.0607671,9.19759398 16.0607671,7.63325261 C16.0607671,6.06891124 14.7880884,4.79623253 13.223747,4.79623253 M3.77625301,11.4095398 C1.6940261,11.4095398 0,9.71551365 0,7.63325261 C0,6.62748755 0.392570281,5.68040321 1.10534137,4.9665739 L1.27407831,4.79759799 L1.27196185,4.79548153 L5.60901004,0.418869076 C5.87575301,0.1496 6.23135341,0.000867068273 6.61037149,-2.04819277e-05 L6.613751,-2.04819277e-05 C6.99143775,-2.04819277e-05 7.34656024,0.147142169 7.61371285,0.414260643 L8.16406225,0.964644177 C8.25373896,1.05435502 8.37308032,1.10381888 8.50003414,1.10381888 C8.62698795,1.10381888 8.74632932,1.05435502 8.83604016,0.96461004 L9.38632129,0.414260643 C9.6534739,0.147108032 10.0086305,-2.04819277e-05 10.3863514,-2.04819277e-05 L10.3902771,-2.04819277e-05 C10.7687149,0.000832931727 11.1243494,0.149565863 11.3910582,0.418800803 L15.7281406,4.79548153 L15.7275261,4.79613012 L15.8947269,4.96653976 C16.6074639,5.68043735 17,6.62752169 17,7.63325261 C17,9.71547952 15.306008,11.4095398 13.2238153,11.4095398 C11.7884759,11.4095398 10.4949056,10.6097546 9.84798394,9.32236305 L9.72949598,9.08654779 L9.5065502,9.22777068 C9.20488554,9.41896948 8.85686345,9.52001365 8.50003414,9.52001365 C8.14320482,9.52001365 7.79514859,9.41896948 7.49351807,9.22780482 L7.27060643,9.08651365 L7.15211847,9.32232892 C6.50512851,10.6097546 5.21159237,11.4095398 3.77625301,11.4095398"
                            strokeWidth="0.3"
                            fillRule="nonzero"
                          />
                        </SVGIcon>
                      ),
                    },
                    {
                      key: 'programme',
                      name: 'Program',
                      onClick: () => navigate('/prime/programs'),
                      icon: (
                        <SVGIcon viewBox={'0 0 16 19'}>
                          <path
                            d="M4.0566736,1.06808409 C4.13755852,1.23777872 4.19115575,1.42044848 4.26199992,1.60968564 L15.4191701,1.60968564 C15.9714549,1.60968564 16.4191701,2.05740089 16.4191701,2.60968564 L16.4191701,12.0212914 C16.4191701,12.574239 16.000801,13.0294713 15.4633397,13.0877114 L15.3464556,13.094006 L5.82709904,13.0940459 C4.68604686,13.0940658 3.54499468,13.0941257 2.40396246,13.0949133 C1.33519169,13.0956029 0.477256669,12.2501439 0.474901185,11.1798361 C0.470769108,9.30365346 0.473943022,7.42743087 0.473843214,5.55122824 C0.473783328,4.36031167 0.475779501,3.16935518 0.472176968,1.97845856 C0.469311902,0.965021697 1.17098653,0.156392138 2.17536078,0.0246846704 C2.93634169,-0.0751039979 3.71604671,0.353334527 4.0566736,1.06808409 Z M15.7854652,2.25516801 L4.29825041,2.25516801 L4.29825041,11.1735282 L3.66781918,11.1735282 C3.66442569,11.1410305 3.66083258,11.1152001 3.65911587,11.0892298 C3.61701659,10.451812 3.10170463,9.94033271 2.46706148,9.90621812 C1.73121237,9.86663402 1.14082436,10.4145435 1.11403573,11.1618506 C1.08894384,11.8616289 1.6686124,12.4543923 2.38943033,12.4552108 C4.53176268,12.4576461 6.67409504,12.4561689 8.81644736,12.4561889 L15.7854652,12.4561689 L15.7854652,2.25516801 Z M11.9181254,9.59148957 C12.0906928,9.59148957 12.2305863,9.73138308 12.2305863,9.90395047 C12.2305863,10.0765179 12.0906928,10.2164114 11.9181254,10.2164114 L11.9181254,10.2164114 L7.85025481,10.2164114 C7.67768742,10.2164114 7.53779391,10.0765179 7.53779391,9.90395047 C7.53779391,9.73138308 7.67768742,9.59148957 7.85025481,9.59148957 L7.85025481,9.59148957 Z M1.87335982,0.765504246 C1.35984442,0.991830295 1.11393592,1.4129229 1.11239887,1.97179135 C1.10986373,2.89663807 1.11269829,3.8214848 1.11259848,4.74633153 C1.11245875,6.37977961 1.11181998,8.01322768 1.11170021,9.64667576 C1.11170021,9.67526095 1.11581232,9.70384614 1.11842731,9.73780104 C1.96522369,9.10491451 2.8045943,9.10367689 3.66258921,9.74085518 L3.66315062,1.95546266 L3.66315062,1.95546266 C3.66378691,1.57942366 3.54098237,1.25276998 3.26233664,1.0009528 C2.85320111,0.631201753 2.3771339,0.543489929 1.87335982,0.765504246 Z M12.8980752,7.172977 C13.0706426,7.172977 13.2105361,7.31287051 13.2105361,7.4854379 C13.2105361,7.65800529 13.0706426,7.7978988 12.8980752,7.7978988 L12.8980752,7.7978988 L6.87030499,7.7978988 C6.69773761,7.7978988 6.5578441,7.65800529 6.5578441,7.4854379 C6.5578441,7.31287051 6.69773761,7.172977 6.87030499,7.172977 L6.87030499,7.172977 Z M13.5537742,4.75446444 C13.7263415,4.75446444 13.8662351,4.89435795 13.8662351,5.06692533 C13.8662351,5.23949272 13.7263415,5.37938623 13.5537742,5.37938623 L13.5537742,5.37938623 L6.21460605,5.37938623 C6.04203866,5.37938623 5.90214515,5.23949272 5.90214515,5.06692533 C5.90214515,4.89435795 6.04203866,4.75446444 6.21460605,4.75446444 L6.21460605,4.75446444 Z"
                            strokeWidth="0.55"
                            fillRule="nonzero"
                          />
                        </SVGIcon>
                      ),
                    },
                    {
                      key: 'projects-prime',
                      name: 'Projects',
                      onClick: () => navigate('/prime/projects'),
                      icon: (
                        <SVGIcon viewBox={'0 0 16 19'}>
                          <path
                            d="M18.1172589,1.15399058 C18.0711578,0.93990784 17.9037601,0.77278103 17.689603,0.727026628 C16.5612971,0.484826658 15.6783052,0.484826658 14.7984273,0.484826658 C11.2093698,0.484826658 9.04894602,2.39128643 7.43208822,4.91362612 L3.92364864,4.91362612 C3.2956999,4.91415742 2.72174623,5.26881179 2.44034682,5.83018001 L0.730415033,9.24865959 C0.602022617,9.50613724 0.616058538,9.8117283 0.767512694,10.0563525 C0.91896685,10.3009767 1.18625497,10.4497717 1.47396894,10.4496254 L4.67792855,10.4496254 L4.3115146,11.1907574 C4.10215964,11.6149728 4.18788685,12.1255724 4.52430457,12.4581552 L6.38474634,14.316867 C6.59191341,14.5250884 6.87332812,14.6424586 7.16705225,14.6431449 C7.33512486,14.6429601 7.50088937,14.6040055 7.65145219,14.5293109 L8.3915461,14.163243 L8.3915461,17.3696246 C8.39306514,17.8276111 8.76395948,18.1985055 9.221946,18.2000245 C9.34969619,18.2000245 9.47565429,18.169964 9.58974395,18.1124865 L13.0047635,16.4035927 C13.5671116,16.1226814 13.9221881,15.5478594 13.9216634,14.9192529 L13.9216634,11.4083913 C16.4398511,9.78980352 18.3563449,7.62107579 18.3563449,4.04862622 C18.3591129,3.16528833 18.3591129,2.28402644 18.1172589,1.15399058 Z M5.0699465,9.34242558 L1.92134689,9.34242558 L3.4295607,6.32530595 C3.52414264,6.13920278 3.71489175,6.02165432 3.92364864,6.02082598 L6.87087628,6.02082598 C6.38855234,6.99204786 5.77336442,8.23522571 5.22530049,9.34242558 L5.0699465,9.34242558 Z M12.8155016,14.9192529 C12.8149969,15.1286754 12.6963604,15.3198864 12.5089456,15.4133408 L9.49874596,16.9198247 L9.49874596,13.6148331 C10.6059458,13.0671151 11.8453177,12.4526192 12.8155016,11.9699493 L12.8155016,14.9192529 Z M13.3220455,10.4807654 C11.9553457,11.1651534 8.62094407,12.8145352 7.16636025,13.5338691 L5.30418848,11.6810393 C6.02629039,10.2198815 7.67532619,6.88582588 8.3569461,5.51601204 C10.0942119,2.80302638 12.0826736,1.59202652 14.7984273,1.59202652 C15.5437112,1.59202652 16.2516271,1.59202652 17.103825,1.7404605 C17.253989,2.6009624 17.251221,3.30472631 17.248453,4.04828022 C17.2491978,6.74984789 16.0381452,8.73554165 13.3220455,10.4807654 Z M13.3739455,3.25282632 C12.1509663,3.25282632 11.1595458,4.24424685 11.1595458,5.46722605 C11.1595458,6.69020525 12.1509663,7.68162578 13.3739455,7.68162578 C14.5969247,7.68162578 15.5883452,6.69020525 15.5883452,5.46722605 C15.5870104,4.24480018 14.5963714,3.25416116 13.3739455,3.25282632 L13.3739455,3.25282632 Z M13.3739455,6.57442592 C12.7624559,6.57442592 12.2667456,6.07871565 12.2667456,5.46722605 C12.2667456,4.85573645 12.7624559,4.36002619 13.3739455,4.36002619 C13.9854351,4.36002619 14.4811454,4.85573645 14.4811454,5.46722605 C14.4811454,6.07871565 13.9854351,6.57442592 13.3739455,6.57442592 Z"
                            strokeWidth="0.5"
                            fillRule="nonzero"
                          />
                        </SVGIcon>
                      ),
                    },
                    {
                      key: 'analytics',
                      name: 'Analytics',
                      onClick: () => navigate('/prime/dashboard'),
                      icon: (
                        <SVGIcon viewBox={'0 0 16 19'}>
                          <path
                            d="M8,2.13162821e-14 C9.1883125,2.13162821e-14 10.1550937,0.96678125 10.1550937,2.15509375 L10.1550937,2.15509375 L10.1550937,13.8449062 C10.1550937,15.0332187 9.1883125,16 8,16 C6.8116875,16 5.84490625,15.0332187 5.84490625,13.8449062 L5.84490625,13.8449062 L5.84490625,2.15509375 C5.84490625,0.96678125 6.8116875,2.13162821e-14 8,2.13162821e-14 Z M2.1550625,9.1805 C3.343375,9.1805 4.31015625,10.1472813 4.31015625,11.3355625 L4.31015625,11.3355625 L4.31015625,13.8449062 C4.31015625,15.0332187 3.34340625,16 2.15509375,16 C0.96678125,16 -5.24025268e-14,15.0332187 -5.24025268e-14,13.8449062 L-5.24025268e-14,13.8449062 L-5.24025268e-14,11.3355625 C-5.24025268e-14,10.1472813 0.96678125,9.1805 2.1550625,9.1805 Z M13.8449062,4.59025 C15.0332187,4.59025 16,5.55703125 16,6.74534375 L16,6.74534375 L16,13.8449375 C16,15.0332187 15.0332187,16 13.8449375,16 C12.656625,16 11.6898437,15.0332187 11.6898437,13.8449062 L11.6898437,13.8449062 L11.6898437,6.74534375 C11.6898437,5.55703125 12.656625,4.59025 13.8449062,4.59025 Z M13.8449375,5.84025 C13.345875,5.84025 12.9398437,6.24625 12.9398437,6.74534375 L12.9398437,6.74534375 L12.9398437,13.8449375 C12.9398437,14.344 13.345875,14.7500312 13.8449062,14.7500312 C14.3439687,14.7500312 14.75,14.344 14.75,13.8449375 L14.75,13.8449375 L14.75,6.74534375 C14.75,6.24625 14.3439687,5.84025 13.8449375,5.84025 Z M2.15509375,10.4305 C1.65603125,10.4305 1.25,10.8365 1.25,11.3355625 L1.25,11.3355625 L1.25,13.8449062 C1.25,14.3439687 1.65603125,14.75 2.1550625,14.75 C2.654125,14.75 3.060125,14.3439687 3.060125,13.8449062 L3.060125,13.8449062 L3.060125,11.3355625 C3.06015625,10.8365313 2.65415625,10.4305 2.15509375,10.4305 Z M8,1.25 C7.5009375,1.25 7.09490625,1.656 7.09490625,2.15509375 L7.09490625,2.15509375 L7.09490625,13.8449062 C7.09490625,14.344 7.5009375,14.75 8,14.75 C8.4990625,14.75 8.90509375,14.344 8.90509375,13.8449062 L8.90509375,13.8449062 L8.90509375,2.15509375 C8.90509375,1.656 8.4990625,1.25 8,1.25 Z"
                            strokeWidth="1"
                            fillRule="nonzero"
                          />
                        </SVGIcon>
                      ),
                    },
                  ],
                },
              ],
            }}
            envURL={
              validURL(BASE_ENV_URL) ? BASE_ENV_URL : PRODUCT_WORKSPACE_URL
            }
            apps={[
              'meeting',
              'taskManagement',
              'okr',
              'edge',
              'peopleSearch',
              'fileManager',
              'planner',
            ]}
            onNewNotification={this.handleNewNotification}
            meeraLogoUrl="/"
            meTo={ENV_VAR_ME_TO}
            lang={lang}
            onLangChange={changeLanguage}
            // onHelpClick={toggleHelpGuide}
            onLogoClick={this.handleLogoClick}
            routes={
              <div className="app-shellwrapper-container">
                <div className="app-shellwrapper-content">
                  <Router>
                    <Redirect from="/" to="/ams" noThrow />
                    <Home path="/ams/*" />
                  </Router>
                </div>
              </div>
            }
          />
        </ContentContext.Provider>
        <Snackbar autohide toasts={toasts} onDismiss={dismissToast} />
      </IntlContext.Provider>
    )
  }
  // handleNotificationItemClick = item => {
  //   const { data: itemData } = item
  //   let { action, url, moduleName, workspaceId, startDate } = itemData || {}
  //   const { productName, body } = item
  //   if (productName === 'meetings' && body.includes('removed')) return
  //   if (moduleName === 'meeting' && action === 'popup') {
  //     location.href = `${PRODUCT_WORKSPACE_URL}/meetings?cat=new&date=${format(
  //       startDate || new Date(),
  //       'YYYY-MM-DD',
  //     )}&wsid=${workspaceId}`
  //     return
  //   }
  //   if (moduleName === 'message') {
  //     const { workspaceId } = itemData
  //     location.href = `${PRODUCT_WORKSPACE_URL}/workspace/details/${workspaceId}`
  //     return
  //   }
  //   if (url) {
  //     if (validURL(url)) {
  //       location.href = url
  //     } else {
  //       url = url[0] === '/' ? url : `/${url}`
  //       location.href = url
  //     }
  //   }
  // }
  handleModuleChange = (key, { jumpUrl }) => {
    if (jumpUrl.startsWith('http')) {
      location.href = jumpUrl
    } else {
      const [prefix] = jumpUrl
      navigate(prefix === '/' ? jumpUrl : '/' + jumpUrl)
    }
  }
}

export function WSAppShell(props) {
  const langs = useSupportedLangs()

  return <AppShellSide languages={langs} {...props} />
}
